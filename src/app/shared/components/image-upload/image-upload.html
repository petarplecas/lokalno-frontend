@if (cropMode()) {
  <!-- Crop editor -->
  <div class="cropzone__editor">
    <div
      class="cropzone"
      (pointerdown)="onCropPointerDown($event)"
      (pointermove)="onCropPointerMove($event)"
      (pointerup)="onCropPointerUp()"
      (pointercancel)="onCropPointerUp()"
      (wheel)="onCropWheel($event)"
    >
      <img
        [src]="cropImageSrc()"
        class="cropzone__img"
        draggable="false"
        (load)="onCropImgLoad($event)"
        [style.transform]="cropTransform()"
        alt=""
      />
    </div>
    <p class="cropzone__hint">Vucite sliku da podesite položaj · Skrolujte za zum</p>
    <div class="cropzone__controls">
      <svg class="cropzone__zoom-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" aria-hidden="true">
        <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        <line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/>
      </svg>
      <input
        type="range"
        class="cropzone__zoom"
        [value]="cropScale()"
        (input)="onZoomChange($event)"
        [min]="cropMinScale()"
        max="3"
        step="0.01"
        aria-label="Zum"
      />
      <button type="button" class="btn-secondary btn--sm cropzone__reset" (click)="resetCrop()" title="Vrati na početni prikaz">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" aria-hidden="true">
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
          <path d="M3 3v5h5"/>
        </svg>
      </button>
    </div>
    <div class="cropzone__actions">
      <button type="button" class="btn-secondary" (click)="cancelCrop()">Otkaži</button>
      <button type="button" class="btn-primary" (click)="confirmCrop()" [disabled]="processing()">
        @if (processing()) {
          <app-spinner size="sm" />
        } @else {
          Potvrdi
        }
      </button>
    </div>
  </div>
} @else {
  <!-- Dropzone -->
  <div
    class="dropzone"
    [class.dropzone--active]="dragOver()"
    [class.dropzone--has-preview]="preview() && !processing()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave()"
    (drop)="onDrop($event)"
    (click)="openFilePicker()"
    role="button"
    tabindex="0"
    (keydown.enter)="openFilePicker()"
    aria-label="Izaberite sliku za upload"
  >
    <input
      #fileInput
      type="file"
      accept="image/jpeg,image/png,image/webp"
      class="dropzone__input"
      (change)="onFileSelected($event)"
    />

    @if (processing()) {
      <div class="dropzone__loading">
        <app-spinner size="sm" />
        <span>Učitavanje...</span>
      </div>
    } @else if (preview()) {
      <img [src]="preview()" alt="Preview" class="dropzone__preview" />
      <span class="dropzone__change">Promenite sliku</span>
    } @else {
      <div class="dropzone__placeholder">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="40" height="40" aria-hidden="true">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" />
        </svg>
        <span>Prevucite sliku ili kliknite</span>
        <span class="dropzone__hint">JPEG, PNG ili WebP</span>
      </div>
    }
  </div>
}

@if (error()) {
  <p class="dropzone__error">{{ error() }}</p>
}
